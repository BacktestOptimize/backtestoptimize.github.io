<html>
  <head>
  </head>
  <body>
    <h3>Aşağıdaki Bağlantıyı, Yer İşaretleri Çubuğuna Sürükleyin..!</h3><br>
    <a title = "Beni Sürükle" href = "javascript:function test(){
	return "";
}

async function baslat(btn){
	
	
	if (btn.innerText == "Başlat!"){
		if(inp1.value != periyot.value){
			alert("1. Giriş değeriyle, 1. Değer Min değeri aynı olmalıdır!");
			return;
		}
		if(inp3.value <= smooth.value){
			alert("2. Giriş değeri, 2. Değer Max değerinden küçük olmalıdır!");
			return;
		}
		durdur = true;
		pmin = inp1.value;
		pmax = inp2.value;
		smax = inp3.value;
		smin = smooth.value;

		kaydet("inp1", pmin);
		kaydet("inp2", pmax);
		kaydet("inp3", smax);
		kaydet("inp4", inp4.value);
		kaydet("inp5", inp5.value);
		if(inp6.checked){
			kaydet("inp6", 1);
		}
		else{
			kaydet("inp6", 0);
		}
		

		btn.disabled = true;

		if(tcheck.checked){
			tcheck.click();
		}
		bilgi.innerHTML = "Stoploss-1 için deneniyor..";
		girisler.slos1[0] = true;
		await input_ayarla(stoploss, inp4.value);
		await init();
		
	}
	
	return false;
	
}
function kaydet(key, val){
	localStorage.setItem(key, val.toString());
}

function cek(key){
	val = localStorage.getItem(key);
	if(val){
		return parseInt(val);
	}
	return 0;
}

function whl(inp, x){
	evt.deltaY = x;
	inp.dispatchEvent(evt);
}

async function eventFire(el, etype){
	setTimeout(function(){el.focus({preventScroll:false});
	},1);
}

async function clk(el){
	if(el.checked) {return;}
	setTimeout(function(){
		el.click();
	}, 1000);
}


async function sonuc_cek(){
	try{
		sonuc = parseFloat(document.getElementsByClassName("data-item")[0].getElementsByTagName("span")[0].innerText.split("%")[0]);
		
		if (isNaN(sonuc) || typeof(sonuc) == "undefined"){
			return parseFloat(0);
		}
		return sonuc;
	} catch(e){
		console.log(e);
		return 0;
	}
}

async function hatalar(){

	if(typeof(periyot) == "undefined"){
		alert("Girdiler Penceresini Açmadınız!\nPencereyi açın ve minimum periyot/smooth değerlerini girin.\nProgramı sonra çalıştırın. ");	
		durdur = false;
		return;
	}
	res = await fetchText();
	
	eval(res);
	baslangic();

}
function evt(){
	var event = document.createEvent('MouseEvents');

	event.initMouseEvent('wheel', true, true);
	return event;
}



function delay(ms) {
  return new Promise(resolve => setTimeout(resolve, ms))
}

async function input_ayarla(inp, val){
	await eventFire(inp, "focus");
	wheel = 100;
	if (parseFloat(inp.value) < val){
		wheel = -100;	
	}
	while(parseFloat(inp.value) != parseFloat(val)){
		setTimeout(function(){whl(inp, wheel);},10);
		await delay(100);
	}
}

async function hmm_ok(){


	if (inp5.value != 0 && girisler.slos2[0] == false){
		bilgi.innerHTML = "Stoploss-2 için deneniyor..";
		girisler.slos2[0] = true;
		await input_ayarla(stoploss, inp5.value);

	}	
	else if (inp6.checked == true && inp5.value == 0 && girisler.tckslos1[0] == false){
		bilgi.innerHTML = "Tralling Stoploss-1 için deneniyor..";
		if(!tcheck.checked){
			await clk(tcheck);
		}
		girisler.tckslos1[0] = true;
		await input_ayarla(stoploss, inp4.value);

	}
	else if (inp6.checked == true && inp5.value!=0 && inp4.value != 0 && girisler.tckslos1[0] == false){
		bilgi.innerHTML = "Tralling Stoploss-1 için deneniyor..";
		if(!tcheck.checked){
			await clk(tcheck);
		}
		girisler.tckslos1[0] = true;
		await input_ayarla(stoploss, inp4.value);
	}

	else if (inp6.checked == true && inp5.value!=0 && girisler.tckslos2[0] == false){
		bilgi.innerHTML = "Tralling Stoploss-2 için deneniyor..";
		if(!tcheck.checked){
			await clk(tcheck);
		}
		girisler.tckslos2[0] = true;
		await input_ayarla(stoploss, inp5.value);

	}
	
	
		

	else{
		return "bitti";
	}
	kazanc_max = 0;	
	return "devam";
}
async function init(){
	
	kazanc_max = await sonuc_cek();
	bilgi_ekran.value = "Periyot: " + parseInt(periyot.value) +"\nSmooth: " + parseInt(smooth.value) + "\nKazanç: % " + kazanc_max + "\n";
	while (durdur == true){

		if (typeof(smooth_deger) != "undefined" && smooth_deger >= smax){
			await input_ayarla(periyot, pmin);
			await input_ayarla(smooth, smin);
			sonuc_text += bilgi.innerText.split(" için")[0] + " :\n\n" + bilgi_ekran.value + "\n";
			if (await hmm_ok() == "bitti"){
				
				bilgi.innerHTML = "En yüksek değerler bulundu";
				bilgi_ekran.value = sonuc_text;
				alert("En yüksek değerler bulundu");
				return;
			}
			
		}
		periyot_deger = parseInt(periyot.value);
		smooth_deger = parseInt(smooth.value);
		
		if (periyot_deger < pmax && periyot_deger > pmin){
			basla = true;
			if(periyot != document.activeElement){
				await eventFire(periyot, "focus");
			}
			setTimeout(function(){whl(periyot, kontrol_up_down)},100);
			
			
		}
		
		
		
		else {
			if(smooth != document.activeElement){
				await eventFire(smooth, "focus");
					
			}
			if(basla == true){
				setTimeout(function(){whl(smooth, -100)},100);
			}

			if(periyot_deger == pmax){
				kontrol_up_down = 100;
			}
			else{
				kontrol_up_down = -100;
			}
			if(periyot != document.activeElement){
				await eventFire(periyot, "focus");
			}
			setTimeout(function(){whl(periyot, kontrol_up_down)},100);
			
			
			
		}
		await delay(900);
		kazanc = await sonuc_cek();
		
		son_sonuc = kazanc;
		if (kazanc > kazanc_max){
			bilgi_ekran.value = "Periyot: " + parseInt(periyot.value) +"\nSmooth: " + parseInt(smooth.value) + "\nKazanç: % " + kazanc + "\n";
			kazanc_max = kazanc;
		}	
		
		
	
	}
}

async function fetchText() {
    
	let response = await fetch("https://raw.githubusercontent.com/hakanzn/test123/main/test.js");
    
	let data = await response.text();
    
	return data;
}



kontrol_up_down = -100;
basla = false;
sonuc_text = "";

girisler = {
	"slos1": [false, 2],
	"slos2" : [false, 15],
	"tckslos1" : [false, 2],
	"tckslos2" : [false, 15]
};

kazanc_max = 0;

evt = evt();
periyot = document.getElementsByClassName("input-3bEGcMc9 with-end-slot-S5RrC8PC")[0];
smooth = document.getElementsByClassName("input-3bEGcMc9 with-end-slot-S5RrC8PC")[1];
stoploss = document.getElementsByClassName("input-3bEGcMc9 with-end-slot-S5RrC8PC")[2];
tcheck = document.getElementsByClassName("input-24iGIobO")[0];


if (typeof(durdur) == "undefined" || durdur == false){
	durdur = true;
	hatalar();
}

else {
	durdur = false;
	alert("Program Durduruldu!");
	location.reload();
}


void(0);

">Backtest Optimize App</a><br><br><br><br>
    <iframe width="560" height="315" src="https://www.youtube.com/embed/9HDEHj2yzew" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe> 
  </body>
</html>
